<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DebateCoach</title>

<style>
:root{
  --bg1:#e6e9ff;
  --bg2:#f2f6ff;
  --card:#ffffff;
  --border:#e3e7ef;
  --text:#0f172a;
  --muted:#5b6475;
  --accent:#4f7cff;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  /* ◊û◊¢◊ò ◊õ◊î◊î ◊ô◊ï◊™◊® */
  background:linear-gradient(180deg,#dfe5ff 0%, #eef2ff 35%, #ffffff 70%);
  color:var(--text);
}

.container{
  max-width:1100px;
  margin:0 auto;
  padding:24px;
}

/* ---------- Header ---------- */
header{
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:16px;
}

h1{
  margin:0;
  font-size:36px;
  letter-spacing:-.5px;
}

.subtitle{
  color:var(--muted);
  margin-top:4px;
  font-size:15px;
}

button{
  font-size:15px;
  padding:10px 14px;
  border-radius:12px;
  border:1px solid var(--border);
  background:#fff;
  cursor:pointer;
}

button.primary{
  background:var(--accent);
  border-color:var(--accent);
  color:#fff;
}

button.ghost{
  background:transparent;
}

button:disabled{
  opacity:.5;
  cursor:not-allowed;
}

/* ---------- Topic ---------- */
.topicBox{
  margin:28px 0 22px;
  padding:22px;
  background:var(--card);
  border:2px solid var(--accent);
  border-radius:20px;
  text-align:center;
  box-shadow:0 10px 30px rgba(79,124,255,.18);
}

.topicLabel{
  font-size:13px;
  letter-spacing:.12em;
  text-transform:uppercase;
  color:var(--muted);
}

.topicText{
  font-size:28px;
  font-weight:800;
  margin-top:6px;
}

/* ---------- Controls ---------- */
.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}

.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:18px;
  padding:18px;
  margin-top:16px;
}

.pill{
  padding:6px 12px;
  border-radius:999px;
  border:1px solid var(--border);
  background:#f8faff;
  font-size:14px;
}

/* ---------- Inputs ---------- */
textarea{
  width:100%;
  min-height:140px;
  padding:14px;
  font-size:17px;
  line-height:1.5;
  border-radius:16px;
  border:1px solid var(--border);
  outline:none;
  resize:vertical;
  background:#fff;
}

textarea:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 4px rgba(79,124,255,.2);
}

input, select{
  width:100%;
  padding:12px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  font-size:16px;
  background:#fff;
  outline:none;
}

input:focus, select:focus{
  border-color:var(--accent);
  box-shadow:0 0 0 4px rgba(79,124,255,.18);
}

.smallBtn{
  padding:10px 12px;
  border-radius:12px;
}

/* ---------- Debate ---------- */
.sectionTitle{
  font-weight:800;
  margin-bottom:8px;
}

#reply{
  font-size:18px;
  line-height:1.55;
  background:#f8faff;
  padding:14px;
  border-radius:16px;
  border:1px solid var(--border);
}

/* ---------- Modal ---------- */
.modalOverlay{
  position:fixed;
  inset:0;
  background:rgba(15,23,42,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  padding:18px;
}

.modalOverlay.open{display:flex}

.modal{
  width:min(860px,100%);
  background:#fff;
  border-radius:18px;
  padding:18px;
  border:1px solid var(--border);
  box-shadow:0 20px 60px rgba(0,0,0,.25);
}

.modalHeader{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:10px;
}

.modalHeader h2{margin:0}

.grid2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
}

@media(max-width:720px){
  .grid2{grid-template-columns:1fr}
}

.divider{
  height:1px;
  background:#eef1f6;
  margin:14px 0;
}

.hint{
  color:var(--muted);
  font-size:13px;
  margin-top:8px;
}
</style>
</head>

<body>
<div class="container">

<header>
  <div>
    <h1>DebateCoach</h1>
    <div class="subtitle">
      One screen. You research elsewhere ‚Äî here you practice debating.
    </div>
  </div>
  <button id="settingsBtn" class="ghost">‚öôÔ∏è Settings</button>
</header>

<!-- TOPIC -->
<div class="topicBox">
  <div class="topicLabel">Debate topic</div>
  <div class="topicText" id="topicText">
    Make English the language of instruction in Israeli schools
  </div>
</div>

<!-- SESSION CONTROLS -->
<div class="card">
  <div class="row">
    <span class="pill" id="turnPill">Your turn</span>
    <span class="pill" id="timer">05:00</span>
    <button id="startBtn" class="primary">‚è± Start session</button>
    <button id="endBtn" disabled>End</button>
    <span style="flex:1"></span>
    <span class="pill" id="speakPill">Auto-speak: ON</span>
    <button id="toggleSpeakBtn" class="smallBtn">Toggle</button>
    <button id="stopSpeakBtn" class="smallBtn" disabled>Stop speaking</button>
  </div>
</div>

<!-- ARGUMENT -->
<div class="card">
  <div class="sectionTitle">Your argument</div>
  <textarea id="userText"
    placeholder="Type, paste from ChatGPT, or dictate your argument here‚Ä¶"></textarea>

  <div class="row" style="margin-top:12px">
    <button id="recBtn" class="primary">üéô Start recording</button>
    <span class="pill" id="recTime">00:00</span>
    <button id="cleanupBtn">‚ú® Clean up</button>
    <button id="teacherBtn">üßë‚Äçüè´ Teacher corrections</button>
  </div>

  <div style="margin-top:10px">
    <div class="sectionTitle">Transcript (what the mic heard)</div>
    <textarea id="transcript" readonly></textarea>
  </div>

  <div class="row" style="margin-top:12px">
    <button id="doneBtn" class="primary">‚úÖ I‚Äôm done (computer replies)</button>
  </div>
</div>

<!-- AI REPLY -->
<div class="card">
  <div class="sectionTitle">Computer reply</div>
  <div id="reply">No reply yet.</div>
</div>

</div>

<!-- SETTINGS MODAL -->
<div id="settingsOverlay" class="modalOverlay">
  <div class="modal">
    <div class="modalHeader">
      <h2>Settings</h2>
      <button id="closeSettingsBtn">‚úï</button>
    </div>

    <div class="divider"></div>

    <div class="grid2">
      <!-- TOPIC SETTINGS -->
      <div class="card" style="margin-top:0">
        <div class="sectionTitle">Topic</div>

        <input id="topicInput" placeholder="Type a debate topic..." />

        <div class="row" style="margin-top:10px">
          <button id="suggestTopicsBtn" class="smallBtn">üí° Suggest topics</button>
          <button id="randomTopicBtn" class="smallBtn">üé≤ Random</button>
        </div>

        <div style="margin-top:10px">
          <select id="topicSelect">
            <option value="">‚Äî pick from suggestions ‚Äî</option>
          </select>
        </div>

        <div class="row" style="justify-content:flex-end;margin-top:12px">
          <button id="applyTopicBtn" class="primary">Apply topic</button>
        </div>

        <div class="hint">
          Tip: you can type your own topic, or ask for suggestions and pick one.
        </div>
      </div>

      <!-- ROLE / DIFFICULTY SETTINGS -->
      <div class="card" style="margin-top:0">
        <div class="sectionTitle">Roles</div>

        <div class="row" style="gap:10px">
          <span class="pill">Student is:</span>
          <select id="studentSide" style="flex:1;min-width:160px">
            <option value="PRO" selected>PRO</option>
            <option value="CON">CON</option>
          </select>
        </div>

        <div class="hint" style="margin-top:8px">Computer automatically takes the opposite side.</div>

        <div class="divider"></div>

        <div class="sectionTitle">Difficulty</div>
        <select id="difficulty">
          <option>Easy</option>
          <option selected>Medium</option>
          <option>Hard</option>
        </select>

        <div class="row" style="justify-content:flex-end;margin-top:12px">
          <button id="applySettingsBtn" class="primary">Apply roles</button>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
/* ---------- Elements ---------- */
const topicTextEl = document.getElementById("topicText");
const overlay = document.getElementById("settingsOverlay");
const settingsBtn = document.getElementById("settingsBtn");
const closeSettingsBtn = document.getElementById("closeSettingsBtn");

const topicInput = document.getElementById("topicInput");
const suggestTopicsBtn = document.getElementById("suggestTopicsBtn");
const randomTopicBtn = document.getElementById("randomTopicBtn");
const topicSelect = document.getElementById("topicSelect");
const applyTopicBtn = document.getElementById("applyTopicBtn");

const studentSideEl = document.getElementById("studentSide");
const difficultyEl = document.getElementById("difficulty");
const applySettingsBtn = document.getElementById("applySettingsBtn");

/* ---------- State ---------- */
let suggestedTopics = [];
let autoSpeak = true;

/* ---------- Modal open/close ---------- */
settingsBtn.onclick = () => overlay.classList.add("open");
closeSettingsBtn.onclick = () => overlay.classList.remove("open");
overlay.onclick = (e) => { if (e.target === overlay) overlay.classList.remove("open"); };

/* ---------- Topic helpers ---------- */
function setTopic(t){
  const cleaned = (t || "").trim();
  if(!cleaned) return;
  topicTextEl.textContent = cleaned;
  topicInput.value = cleaned;
}

function currentTopic(){
  return (topicInput.value || topicTextEl.textContent || "").trim();
}

/* Init topic input from main display */
topicInput.value = topicTextEl.textContent.trim();

/* ---------- Suggest topics ---------- */
suggestTopicsBtn.onclick = async () => {
  suggestTopicsBtn.disabled = true;
  suggestTopicsBtn.textContent = "Generating‚Ä¶";
  try{
    const res = await fetch("/topics");
    const data = await res.json();
    if(!res.ok) throw new Error((data && (data.error || data.details)) || "Failed");

    suggestedTopics = Array.isArray(data.topics) ? data.topics : [];

    topicSelect.innerHTML = `<option value="">‚Äî pick from suggestions ‚Äî</option>`;
    for(const t of suggestedTopics){
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      topicSelect.appendChild(opt);
    }
  }catch(err){
    alert("Topics failed: " + (err?.message || err));
  }finally{
    suggestTopicsBtn.disabled = false;
    suggestTopicsBtn.textContent = "üí° Suggest topics";
  }
};

topicSelect.onchange = () => {
  if(topicSelect.value) topicInput.value = topicSelect.value;
};

randomTopicBtn.onclick = () => {
  if(!suggestedTopics.length){
    alert("No suggestions yet. Click 'Suggest topics' first.");
    return;
  }
  const t = suggestedTopics[Math.floor(Math.random()*suggestedTopics.length)];
  topicInput.value = t;
};

applyTopicBtn.onclick = () => {
  setTopic(currentTopic());
  overlay.classList.remove("open");
};

/* ---------- Roles / difficulty apply (kept minimal for now) ---------- */
applySettingsBtn.onclick = () => {
  // ◊õ◊ê◊ü ◊ë◊¢◊™◊ô◊ì ◊†◊ó◊ë◊® ◊ú◊ú◊ï◊í◊ô◊ß◊î ◊©◊ú /ask ◊õ◊ì◊ô ◊©◊î◊û◊ó◊©◊ë ◊ô◊ß◊ó ◊ê◊™ ◊î◊¶◊ì ◊î◊†◊í◊ì◊ô,
  // ◊ê◊ë◊ú ◊õ◊®◊í◊¢ ◊ñ◊î ◊®◊ß ◊†◊©◊û◊® ◊ë-UI (◊î◊©◊®◊™ ◊ê◊¶◊ú◊ö ◊õ◊ë◊® ◊ô◊ï◊ì◊¢ ◊ú◊¢◊ë◊ï◊ì ◊¢◊ù stance).
  overlay.classList.remove("open");
};

/* ---------- Auto-speak toggle (UI only here) ---------- */
const speakPill = document.getElementById("speakPill");
document.getElementById("toggleSpeakBtn").onclick = () => {
  autoSpeak = !autoSpeak;
  speakPill.textContent = "Auto-speak: " + (autoSpeak ? "ON" : "OFF");
};
</script>

</body>
</html>